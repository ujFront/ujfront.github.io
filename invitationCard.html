<!DOCTYPE html>
<html>

<head>
    <title>Submit to Google Sheet & Doc</title>
    <link href="assets/css/uj_colors.css" rel="stylesheet">
</head>

<body>

    <div class="container">
        <div class="row">
            <div class="col">
                <h2 class="mb-3" >Available templates</h2>
                <div id="imgCarousel" class="carousel slide">
                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <figure class="figure">
                                <img src="/assets/img/invitations/invitation_monkey.jpg"
                                    class="figure-img img-fluid rounded" alt="Monkey design">
                                <figcaption class="figure-caption text-center fs-5">Monkey</figcaption>
                            </figure>
                        </div>
                        <div class="carousel-item">
                            <figure class="figure">
                                <img src="/assets/img/invitations/invitation_forrest.jpg"
                                    class="figure-img img-fluid rounded" alt="Forest design">
                                <figcaption class="figure-caption text-center fs-5">Forest</figcaption>
                            </figure>
                        </div>
                        <div class="carousel-item">
                            <figure class="figure">
                                <img src="/assets/img/invitations/invitation_climber.jpg"
                                    class="figure-img img-fluid rounded" alt="Outdoor Climber design">
                                <figcaption class="figure-caption text-center fs-5">Outdoor Climber</figcaption>
                            </figure>
                        </div>
                        <div class="carousel-item">
                            <figure class="figure">
                                <img src="/assets/img/invitations/invitation_balloons.jpg"
                                    class="figure-img img-fluid rounded" alt="Star Balloons design">
                                <figcaption class="figure-caption text-center fs-5">Star Balloons</figcaption>
                            </figure>
                        </div>
                        <div class="carousel-item">
                            <figure class="figure">
                                <img src="/assets/img/invitations/invitation_spiderman.jpg"
                                    class="figure-img img-fluid rounded" alt="Spiderman design">
                                <figcaption class="figure-caption text-center fs-5">Spiderman</figcaption>
                            </figure>
                        </div>
                        <div class="carousel-item">
                            <figure class="figure">
                                <img src="/assets/img/invitations/invitation_cinderella.jpg"
                                    class="figure-img img-fluid rounded" alt="...">
                                <figcaption class="figure-caption text-center fs-5">Cinderella</figcaption>
                            </figure>
                        </div>
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#imgCarousel"
                        data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#imgCarousel"
                        data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
            </div>
            <div class="col">
                <form id="submission-form" class="mt-3 p-3">
                    <div class="card text-center p-3 border-1 border-light bg-light mt-3">
                        <!-- <h5 class="card-header text-bg-success ">Card template</h5> -->
                        <div class="card-body">
                            <h2 class="card-title">Let's celebrate!</h5>
                                <div class="p-3 mb-2">
                                    <label class="form-label h6" for="name">Name</label>
                                    <input type="text" class="form-control text-center" id="name" name="name"
                                        maxlength="13" placeholder="Peter" aria-describedby="nameHelp">
                                    <div id="nameHelp" class="form-text">Enter name of your child (or children)</div>
                                </div>
                                <div class="p-3 mb-2">
                                    <label class="form-label" for="underName">info under the name</label>
                                    <input type="text" class="form-control text-center" id="underName" name="underName"
                                        maxlength="16" placeholder="is turning 10" aria-describedby="underNameHelp">
                                    <div id="underNameHelp" class="form-text">for exmaple: is turning 10 / are turning
                                        15</div>
                                </div>
                                <div class="mb-2">
                                    <p class="h5 m-0">at Urban Jungle</p>
                                    <small class="text-muted">Indoor Rock Climbing</small>
                                </div>
                                <div class="p-3 mb-0">
                                    <label class="form-label h6" for="date">On</label>
                                    <input type="date" class="form-control" id="date" name="date"
                                        aria-describedby="dateHelp">
                                </div>
                                <div class="input-group p-3 mb-2">
                                    <span class="input-group-text" for="fromTime">From</span>
                                    <input type="time" class="form-control" id="fromTime" name="fromTime">
                                    <span class="input-group-text" for="toTime">To</span>
                                    <input type="time" class="form-control" id="toTime" name="toTime">
                                </div>
                                <div class="p-3 mb-2 ">
                                    <label class="form-label h6" for="message">RSVP</label>
                                    <input class="form-control text-center" id="message" name="message" maxlength="50"
                                        placeholder="John on 0412 345 678 by 10 Feb 2024"
                                        aria-describedby="rsvpHelp"></input>
                                    <div id="rsvpHelp" class="form-text">Enter your name and how you wish to be
                                        contacted
                                        (phone/email) and due date.</div>
                                </div>
                                <p class="form-label h6" >Select your invitation card design:</p>
                                <ul class="list-group list-group-horizontal">
                                    <li class="list-group-item flex-fill">
                                        <input class="form-check-input" type="radio" name="designChoice" id="design1"
                                            value="1EeKm1_wuFKBK_MtdqlKRmjimq72DjRxWz-l5t9B3dx4" checked>
                                        <label class="form-check-label" for="design1">Monkey</label>
                                    </li>
                                    <li class="list-group-item flex-fill">
                                        <input class="form-check-input" type="radio" name="designChoice"
                                                id="design2" value="11QupS9O56sP-gdxVPotDeOoRR3evi_RCVsRI04SyJH8">
                                        <label class="form-check-label" for="design2">Forest</label>
                                    </li>
                                    <li class="list-group-item flex-fill">
                                        <input class="form-check-input" type="radio" name="designChoice"
                                                id="design3" value="1Y8-dBa2uFrK1AMBmY7R_QgXTA6toMKlPn3S7e_SzRHc">
                                        <label class="form-check-label" for="design3">Outdoor Climber</label>
                                    </li>
                                </ul>
                                <ul class="list-group list-group-horizontal" style="margin-top: -1px;">
                                    <li class="list-group-item flex-fill">
                                        <input class="form-check-input" type="radio" name="designChoice"id="design4" value="1lEo5_razLqvC8qpGXyUkbXb5sp04vz8cmwgdqe_2ZaM">                                        
                                        <label class="form-check-label" for="design4">Star Balloons</label>
                                    </li>
                                    <li class="list-group-item flex-fill">
                                        <input class="form-check-input" type="radio" name="designChoice" id="design5" value="1b7CS9f-FJiV0mGcFxstPEkD002g8ujuPsiSuUo8aQNQ">
                                        <label class="form-check-label" for="design5">Spiderman</label>
                                    </li>
                                    <li class="list-group-item flex-fill">
                                        <input class="form-check-input" type="radio" name="designChoice" id="design6" value="1PkdR8hPSvRzKS_MI8hucsG3wUifcIcdnTTTwONSAFsg">
                                        <label class="form-check-label" for="design6">Cinderella</label>
                                    </li>
                                </ul>
                        </div>

                        <hr>

                        <!-- Notification -->
                        <div id="notification" class="mt-3">
                            <div class="alert alert-light" role="alert">
                                Please <strong>review all provided details</strong> for accuracy before submitting your
                                invitation card request.
                            </div>
                        </div>

                        <div class="row d-flex justify-content-between">
                            <div class="col-8 input-group">
                                <label class="input-group-text" for="email">Your email</label>
                                <input type="email" class="form-control" id="email" name="email">
                            </div>
                            <div class="col">
                                <!-- Button with a spinner -->
                                <button type="submit" class="btn btn-success">
                                    <span id="spinner" class="d-none spinner-border spinner-border-sm"
                                        aria-hidden="true"></span>
                                    <span class="visually-hidden" role="status">Loading...</span>
                                    Create My Invitation
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

    </div>

    <!-- Bootstrap Modal for Validation Messages -->
    <div class="modal fade" id="validationModal" tabindex="-1" aria-labelledby="validationModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-primary" id="validationModalLabel">Validation Error</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Validation message will be inserted here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Fix Mistakes</button>
                    <button type="button" class="btn btn-outline-primary" id="acceptConditions">Accept and
                        Proceed</button>
                </div>
            </div>
        </div>
    </div>


    <!-- Bootstrap JS, Popper.js, and jQuery for Bootstrap Modal -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>

    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbx8aXJlgiagmKQIg9Hneab875sgdrZccItJWwT8oN8xMRCEGsW9t2NMG3LeGW2V3hra/exec';
        document.getElementById('submission-form').addEventListener('submit', function (e) {
            e.preventDefault(); // Prevent the default form submission

            // Validation logic
            const email = document.getElementById('email').value;
            const date = document.getElementById('date').value;
            const fromTime = document.getElementById('fromTime').value;
            const toTime = document.getElementById('toTime').value;


            // Check if email is empty
            if (!email) {
                displayModal('Please provide an email address.');
                return; // Stop execution if no email
            }

            // Other validation checks
            const errorMessage = validateForm(date, fromTime, toTime);
            if (errorMessage) {
                // Show modal with error message but provide an option to proceed
                displayModal(errorMessage, true); // True indicates there's an option to accept and proceed
            } else {
                submitForm(); // Directly submit if no errors and email is present
            }
        });

        function displayModal(message, canProceed = false) {
            document.querySelector('.modal-body').innerHTML = message;
            var myModal = new bootstrap.Modal(document.getElementById('validationModal'));

            // If canProceed is true, show the "Accept and Proceed" button
            if (canProceed) {
                document.getElementById('acceptConditions').style.display = 'block';
                document.getElementById('acceptConditions').onclick = function () {
                    myModal.hide();
                    submitForm(); // Implement this function to submit the form or perform the fetch operation
                };
            } else {
                // If email is missing, don't show the "Accept and Proceed" button
                document.getElementById('acceptConditions').style.display = 'none';
            }

            myModal.show();
        }

        function validateForm(date, fromTime, toTime) {
            let errorMessage = '';
            const selectedDate = new Date(date);
            const currentDate = new Date();
            currentDate.setHours(0, 0, 0, 0); // Reset time part to compare only dates

            // Date is in the future
            if (selectedDate <= currentDate) {
                errorMessage += 'The date must be in the future.<br>';
            }

            // Difference between from and to times is not more than 2 hours
            const from = new Date(`1970-01-01T${fromTime}:00`);
            const to = new Date(`1970-01-01T${toTime}:00`);
            if ((to - from) > 7200000) { // 2 hours in milliseconds
                errorMessage += 'The time difference must not exceed 2 hours.<br><small class="text-mutted">Urban Jungle group bookings have 2 hrs limit.</small><br>';
            }

            // The from time is either 10:30 AM, 12:30 PM, or 3:30 PM
            const validTimes = ['10:30', '13:00', '15:30']; // 24-hour format
            if (!validTimes.includes(fromTime)) {
                errorMessage += 'The start time must be either 10:30 AM, 1:00 PM, or 3:30 PM.<br><small class="text-mutted">Regular weekend bookings are as listed. Please do not invite your guest earlier unless previously arranged with us.</small><br>';
            }

            return errorMessage;
        }

        function submitForm() {

            // Show spinner
            document.getElementById('spinner').classList.remove('d-none');
            // Hide notification (just in case the form is resubmitted)
            const notification = document.getElementById('notification');
            notification.classList.add('d-none');

            const formData = {
                name: document.getElementById('name').value,
                underName: document.getElementById('underName').value,
                email: document.getElementById('email').value,
                date: document.getElementById('date').value,
                fromTime: document.getElementById('fromTime').value,
                toTime: document.getElementById('toTime').value,
                message: document.getElementById('message').value,
                designChoice: document.querySelector('input[name="designChoice"]:checked').value
            };

            fetch(scriptURL, {
                method: 'POST',
                mode: 'no-cors', // Important for CORS policy
                cache: 'no-cache',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            })
                .then(response => {
                    // Hide spinner
                    document.getElementById('spinner').classList.add('d-none');

                    // Show notification
                    notification.classList.add('alert', 'alert-success');
                    notification.innerHTML = `<h4 class="alert-heading">All done, we've received your request!</h4>
                                            <p class="m-0">An email with the invitation card will be sent to your address <strong>${document.getElementById('email').value}</strong> shortly.</p>
                                            <small>Please check your spam folder if not received within an hour.</small>
                                            <hr>
                                            <p class="m-0">If you have any additional questions or need further assistance, please feel free to contact us.</p>
                                            <p class="mb-0">Thank you for choosing <a href="http://urbanjungleirc.com" class="alert-link">Urban Jungle IRC</a>!</p>`;
                    notification.classList.remove('d-none');
                })
                .catch(error => {
                    // Hide spinner
                    document.getElementById('spinner').classList.add('d-none');

                    // Show error notification
                    notification.classList.add('alert', 'alert-danger');
                    notification.textContent = 'Applogies, there was an error submitting your request. Please try again.';
                    notification.classList.remove('d-none');
                });
        }

    </script>

</body>

</html>